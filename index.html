<!DOCTYPE html>
<html>
  <head>
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
    <link rel="stylesheet" type="text/css" href="twittler.css">
  </head>
  <body>
    <script>
      var logsOn = true;

      var twittlerScope = {};
      twittlerScope.maxTweets = 20;
      twittlerScope.lastUpdatedTime = 0;
      twittlerScope.lastUpdatedBy = '';

      log('start');
      $(document).ready(function(){
        setTimeout(function(){
          log('first update'); 
          update()
        }, 1000);
        setInterval(function(){
            update();
        }, 10000);
      });

      function update(){
        var $newHolder = $('.newHolder');
        var $oldHolder = $('.oldHolder');
        var $archive = $('.archiveHolder');
        //move former new tweets to old tweets
        log('moving old');
        while ($newHolder.children().length > 0){
          $newHolder.children().last().prependTo($oldHolder);
        }
        //move excess tweets to archive
        log('archiving');
        while ($oldHolder.children().length > twittlerScope.maxTweets){
          $archive.prepend($oldHolder.children().last());
        }
        //get new tweets
        log('new tweets');
        var index = streams.home.length - 1;
        while (index >= 0 && 
                (streams.home[index].created_at > twittlerScope.lastUpdatedTime || 
                  (streams.home[index].created_at == twittlerScope.lastUpdatedTime && streams.home[index].user != twittlerScope.lastUpdatedBy))) {
          $newHolder.append(makeTweet(streams.home[index]));
          index -= 1;
        } 
        twittlerScope.lastUpdatedTime = streams.home[streams.home.length - 1].created_at;
        twittlerScope.lastUpdatedBy = streams.home[streams.home.length - 1].user;
      }

      function makeTweet(tweet){
        var $tweet = $('<div class="tweet"></div>');
        var tweetText = '';
        $tweet.append($('<div class="tweetTime">' + timeStamp(tweet.created_at) + '</div>'));
        $tweet.append($('<div class="tweetUser">' + tweet.user + '</div>'));
        $tweet.append($('<div class="tweetContent">' + tweet.message + '</div>'));
        return $tweet;
      }

      function timeStamp(time){
        return time.toString();
      }

      function log(msg) {
        setTimeout(function() {
          if(logsOn) {
            throw new Error(msg);
          }
        }, 0);
      }
    </script>
    <!-- content -->
    <div class="header">
      Twttler
    </div>
    <div class="leftPanel">
      <div class="profile">
        name and stuff
      </div>
      <div class="menu">
        options and stuff
      </div>
    </div>
    <div class="main">
      <div class="holder newHolder">
      </div>
      <div class="holder oldHolder">
      </div>
      <div class="holder archiveHolder">
      </div>
    </div>
  </body>
</html>
